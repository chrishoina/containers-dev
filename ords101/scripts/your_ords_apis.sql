
-- Generated by ORDS REST Data Services 25.2.3.r2241517
-- Schema: ORDS105  Date: Wed Sep 24 04:23:26 2025 
--
        
-- Note: This script requires the role 'ORDS_ADMINISTRATOR_ROLE' to execute successfully. 
-- Ensure the user has the necessary privileges before running. 
--    
SET DEFINE OFF

DECLARE
  l_roles     OWA.VC_ARR;
  l_modules   OWA.VC_ARR;
  l_patterns  OWA.VC_ARR;

BEGIN
  ORDS_ADMIN.DEFINE_MODULE(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_base_path      => '/protected_endpoint_examples/',
      p_items_per_page => 25,
      p_status         => 'PUBLISHED',
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'client-credentials',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'client-credentials',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'begin
  owa_util.mime_header(''text/html'', FALSE);
  owa_util.http_header_close;

-- Authenticated user header
  htp.p(''<h2>Authenticated User</h2>'');
  htp.p(''<p><b>The user you just authenticated with</b> (i.e., the ORDS <code>:current_user</code> Implicit parameter): '' || :current_user || ''</p>'');
  
  -- Authentication Info
  htp.p(''<h2>Authentication Info</h2>'');
  htp.p(''<p>The Client Credentials grant type is designed for machine-to-machine (M2M) communication. Here, the application requests an access token directly from the authorization server by presenting its own credentials, without user involvement. This is suitable for background services or daemons.</p>'');

  -- Bulleted list
   -- Indented "The flow" section
  htp.p(''<div style="margin-left:2em;">'');
  htp.p(''<h3>The flow:</h3>'');
  htp.p(''<ul>
    <li>No user interaction is involved.</li>
    <li>The client application authenticates with its own credentials (client_id and client_secret).</li>
    <li>Used for accessing ' || 'protected resources under the application’s own authority.</li>
    <li>Commonly used in microservices and server-to-server API calls.</li>
    <li>High security when credentials are kept confidential.</li>
    </ul>'');
  htp.p(''</div'');

  -- Grant Type Summary Table

htp.tableCaption(''Grant Type Summary Table'');
  htp.p(''<table border="1" cellpadding="4" cellspacing="0">'');
  htp.p(''<tr>
        <th>Grant Type</th>
        <th>Use Case</th>
        <th>Security</th>
        <th>Recommended</th>
      </tr>'');
  htp.p(''<tr>
          <td>Authorization Code</td>
          <td>Web apps (server-side)</td>
          <td style="text-align:center;">High</td>
          <td style="text-align:center;">Yes</td>
        </tr>'');
  htp.p(''<tr>
          <td style="background-color:#D3D3D3;">Client Credentials</td>
          <td style="background-color:#D3D3D3;">Machine-to-machine APIs</td>
          <td style="text-align:center; background-color:#D3D3D3;">High</td>
          <td style="text-align' || ':center; background-color:#D3D3D3;">Yes</td>
        </tr>'');
  htp.p(''<tr>
          <td>Implicit</td>
          <td>Browser-based clients (SPA)</td>
          <td style="text-align:center;">Low</td>
          <td style="text-align:center;">No (Use PKCE instead)</td>
        </tr>'');
  htp.p(''</table>'');

  -- Link
  htp.br();
  htp.p(''<h3>Additional reading:</h3>'');
  htp.p(''<ul>
        <li><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/ords-pl-sql-package-reference.html#GUID-61C52D86-849B-463C-A22B-DE189EB6E26D" target="_blank">
             ORDS PL/SQL Package Reference
           </a></li>
        <li><a href="https://blogs.oracle.com/developers/post/microservices-the-easy-way-with-ords-and-micronaut-part-1" target="_blank">An ORDS Client Credentials practical example (blog)</a></li>
      </ul>'');

    htp.p(''
<div style="position: fixed; bottom: 10px; right: 20px; font-size: smaller; color: gray; z-index: 1000; display: flex; align-item' || 's: center;">
  <svg width="24" height="24" viewBox="0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
    <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.4722 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.9153 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3674 40.6292 ' || '65.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.3042 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68.4639 32.802' || '8 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 68.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
  </svg>
  <sup>Feeling RESTful? Let’s POST about it!</sup>
</div>
'');
end;');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'implicit-grant',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'implicit-grant',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'begin
  owa_util.mime_header(''text/html'', FALSE);
  owa_util.http_header_close;

  -- Authenticated user header
  htp.p(''<h2>Authenticated User</h2>'');
  htp.p(''<p><b>User:</b> '' || :current_user || ''</p>'');

  -- Authentication Info
  htp.p(''<h2>Authentication Info</h2>'');
  htp.p(''<p>The Implicit grant type is mainly used by single-page applications (SPAs) and other browser-based clients. The client-side application obtains tokens directly from the authorization endpoint, bypassing the need for a backend code exchange. Because tokens are exposed to the browser, this method is less secure and generally NOT recommended—PKCE should be used instead where possible.</p>'');

  -- Bulleted list
    -- Indented "The flow" section
  htp.p(''<div style="margin-left:2em;">'');
  htp.p(''<h3>The flow:</h3>'');
  htp.p(''<ul>
    <li>User is redirected to the authorization server.</li>
    <li>User grants consent and receives an access token directly via a URL fragment.</li>
    <li>No intermediate aut' || 'horization code step.</li>
    <li>Tokens are exposed in the browser and can potentially be intercepted.</li>
    <li>Generally not recommended; use Authorization Code with PKCE for SPAs.</li>
    </ul>'');
  htp.p(''</div>'');

  -- Grant Type Summary Table
  htp.p(''<h2>Grant Type Summary Table</h2>'');
  htp.p(''<table border="1" cellpadding="4" cellspacing="0">'');
  htp.p(''<tr>
        <th>Grant Type</th>
        <th>Use Case</th>
        <th>Security</th>
        <th>Recommended</th>
      </tr>'');
  htp.p(''<tr>
          <td>Authorization Code</td>
          <td>Web apps (server-side)</td>
          <td style="text-align:center;">High</td>
          <td style="text-align:center;">Yes</td>
        </tr>'');
  htp.p(''<tr>
          <td>Client Credentials</td>
          <td>Machine-to-machine APIs</td>
          <td>High</td>
          <td>Yes</td>
        </tr>'');
  htp.p(''<tr>
          <td style="background-color:#D3D3D3;">Implicit</td>
          <td style="background-color:#D3D3D3;">Br' || 'owser-based clients (SPA)</td>
          <td style="text-align:center; background-color:#D3D3D3;">Low</td>
          <td style="text-align:center; background-color:#D3D3D3;">No (Use PKCE instead)</td>
        </tr>'');
  htp.p(''</table>'');

  -- Link
  htp.br();
  htp.p(''<h3>Additional reading:</h3>'');
  htp.p(''<ul>
        <li><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/ords-pl-sql-package-reference.html#GUID-61C52D86-849B-463C-A22B-DE189EB6E26D" target="_blank">
             ORDS PL/SQL Package Reference
           </a></li>
           <li><a href="https://www.thatjeffsmith.com/archive/2021/11/ords-oauth2-clients-who-are-you-hint-current_user/" target="_blank">
             A quick <code>:current_user</code> demo (blog)
           </a></li>
      </ul>'');
htp.p(''
<div style="position: fixed; bottom: 10px; right: 20px; font-size: smaller; color: gray; z-index: 1000; display: flex; align-items: center;">
  <svg width="24" height="24" viewBox=' || '"0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
    <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.4722 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.9153 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3674 40.6292 65.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3' || '278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.3042 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68.4639 32.8028 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 6' || '8.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
  </svg>
  <sup>GET in the RESTful spirit!</sup>
</div>
'');
end;');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'authorization-code',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'OAuth2.0 Examples',
      p_pattern        => 'authorization-code',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'begin
  owa_util.mime_header(''text/html'', FALSE);
  owa_util.http_header_close;
  
  -- Authenticated user header
  htp.p(''<h2>Authenticated User</h2>'');
  htp.p(''<p><b>The user you just authenticated with</b> (i.e., the ORDS <code>:current_user</code> Implicit parameter): '' || :current_user || ''</p>'');
  
  -- Authentication Info
  htp.p(''<h2>About the Authentication Code Grant Type</h2>'');
  htp.p(''<p>The Authorization Code grant type is used by server-side applications. The client redirects the user to the authorization server, obtains an authorization code, and then exchanges it for an access token. This method is highly secure, as tokens are never exposed directly to the browser.</p>'');
  
  -- Bulleted list
  -- Indented "The flow" section
  htp.p(''<div style="margin-left:2em;">'');
  htp.p(''<h3>The flow:</h3>'');
  htp.p(''<ul>
      <li>User is redirected to the authorization server.</li>
      <li>User grants consent and an authorization code is issued.</li>
      <li>Client exch' || 'anges authorization code for an access token (server-to-server).</li>
      <li>Access and refresh tokens are securely handled on the backend.</li>
    </ul>'');
  htp.p(''</div>'');
  
  -- Grant Type Summary Table
  htp.p(''<h2>Grant Type Summary Table</h2>'');
  htp.p(''<table border="1" cellpadding="4" cellspacing="0">'');
  htp.p(''<tr>
        <th>Grant Type</th>
        <th>Use Case</th>
        <th>Security</th>
        <th>Recommended</th>
      </tr>'');
  htp.p(''<tr>
          <td style="background-color:#D3D3D3;">Authorization Code</td>
          <td style="background-color:#D3D3D3;">Web apps (server-side)</td>
          <td style="text-align:center; background-color:#D3D3D3;">High</td>
          <td style="text-align:center; background-color:#D3D3D3;">Yes</td>
        </tr>'');
  htp.p(''<tr>
          <td>Client Credentials</td>
          <td>Machine-to-machine APIs</td>
          <td style="text-align:center;">High</td>
          <td style="text-align:center;">Yes</td>
        </tr' || '>'');
  htp.p(''<tr>
          <td>Implicit</td>
          <td>Browser-based clients (SPA)</td>
          <td style="text-align:center;">Low</td>
          <td style="text-align:center;">No (Use PKCE instead)</td>
        </tr>'');
  htp.p(''</table>'');
  
  -- Link
  htp.br();
  htp.p(''<h3>Additional reading:</h3>'');
  htp.p(''<ul>
        <li><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/ords-pl-sql-package-reference.html#GUID-61C52D86-849B-463C-A22B-DE189EB6E26D" target="_blank">
         ORDS PL/SQL Package Reference</a></li>
        <li><a href="https://followthecoffee.com/an-ords-get-request-to-retrieve-cgi-environment-variables-from-the-print_cgi_env-pl-sql/" target="_blank">
         Combining ORDS and the PRINT_CGI_ENV procedure tutorial</a></li>
      </ul>'');
  -- Fixed bottom-right superscript phrase
htp.p(''
<div style="position: fixed; bottom: 10px; right: 20px; font-size: smaller; color: gray; z-index: 1000; display: flex; align-items' || ': center;">
  <svg width="24" height="24" viewBox="0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
    <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.4722 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.9153 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3674 40.6292 6' || '5.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.3042 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68.4639 32.8028' || ' 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 68.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
  </svg>
  <sup>REST easy, ORDS has you covered!</sup>
</div>
'');
end;');

  ORDS_ADMIN.DEFINE_MODULE(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_base_path      => '/ords_native_examples/',
      p_items_per_page => 25,
      p_status         => 'PUBLISHED',
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'batchload',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'batchload',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'BEGIN
  owa_util.mime_header(''text/html'', TRUE);

  -- Page setup, CSS, & JS
  htp.p(q''[
  <html>
  <head>
  <title>ORDS Batchload: PROJECT Example</title>
  <style>
    body { font-family: Arial, sans-serif; }
    code, pre { background-color: #f4f4f4; padding: 2px 4px; border-radius: 4px; }
    table { border-collapse: collapse; width: 95%; }
    th, td { border: 1px solid #bbb; padding: 6px 8px; text-align: left; }
    th { background-color: #eee; }
    div.copy-block { margin-bottom: 16px; display: flex; flex-direction: column; align-items: flex-start; }
    button.copyBtn { margin-top: 3px; font-size: 0.96em; cursor: pointer; }
  </style>
  <script>
    function copyBlock(id) {
      var code = document.getElementById(id);
      if(code) navigator.clipboard.writeText(code.innerText);
    }
  </script>
  </head>
  <body>
  ]'');

  htp.p(q''[
  <h1>ORDS Batchload: PROJECT Table Example</h1>
  <p>
    This page demonstrates how to use the ORDS AutoREST
    <b><code>BATCHLOAD</code></b' || '> endpoint for the <code>PROJECT</code> table.
    Use the sample Python script to generate a test CSV file or create your own.
  </p>
  ]'');

  -- PYTHON SCRIPT DETAILS
  htp.p(q''[
  <details>
    <summary style="font-size:1.1em;cursor:pointer;"><kbd style="font-size: 10px;">(click) </kbd>
      Python script to generate a <code>project_data.csv</code> file.
    </summary>
    <p>This script creates mock <code>project_data.csv</code> for testing <code>BATCHLOAD</code>. Adjust the row count as needed.</p>
    <b>Sample Script</b> (not for production use):
    <div class="copy-block">
      <pre><code id="pycodegen" class="language-python">
import csv
import argparse
import random

OUTPUT_FILE = "project_batchload.csv"
PROJECTS = ["Project Alpha", "Beta Initiative", "Gamma Ops", "Delta Mission"]

def main(num_rows):
    try:
        with open(OUTPUT_FILE, "w", newline="", encoding="utf-8") as csvfile:
            fieldnames = ["PROJ_ID", "PROJ_NAME", "DEPT_ID", "IS_ACTIVE"]
            ' || 'writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
            writer.writeheader()
            for i in range(1, num_rows + 1):
                proj_name = random.choice(PROJECTS) + " " + str(1000 + i)
                dept_id = random.randrange(1,10)
                is_active = random.choice(["true", "false"])
                writer.writerow({
                    "PROJ_ID": i,
                    "PROJ_NAME": proj_name,
                    "DEPT_ID": dept_id,
                    "IS_ACTIVE": is_active
                })
    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Generate project CSV data.")
    parser.add_argument("-n", "--num_rows", type=int, default=100,
        help="Number of rows to generate (default: 100)")
    args = parser.parse_args()
    main(args.num_rows)

</code></pre>
      <button class="copyBtn" onclick="copyBlock(''pycodegen'')">Copy code</button>
    </div>
    <' || 'b>How to use:</b>
    <div class="copy-block">
      <pre id="pyusage">python generate_projects.py
python generate_projects.py --num_rows 1000</pre>
      <button class="copyBtn" onclick="copyBlock(''pyusage'')">Copy usage</button>
    </div>
    <ul>
      <li><code>PROJ_ID</code> is unique for each row (optional for inserts if auto-generated).</li>
      <li><code>DEPT_ID</code> must reference a valid department (see your data).</li>
      <li><code>IS_ACTIVE</code> should be <code>true</code> or <code>false</code>.</li>
    </ul>
  </details>
  ]'');

  -- Section 1: CSV Example
  htp.p(q''[
  <h2>1. Example CSV File (<code>project_data.csv</code>)</h2>
  <p>Your CSV should look like this:</p>
  <div class="copy-block">
  <pre id="csvfile">PROJ_ID,PROJ_NAME,DEPT_ID,IS_ACTIVE
1,Project Alpha 1001,1,true
2,Beta Initiative 1002,7,false
3,Gamma Ops 1003,8,true
</pre>
  </div>
  ]'');

  -- Section 2: cURL Example
  htp.p(q''[
  <h2>2. Sample cURL Command</h2>
  <p>Sample cURL command with <co' || 'de>BATCHLOAD</code> options.</p>
  <div class="copy-block">
  <pre id="curlcmd">curl -X POST "https://&lt;host&gt;:&lt;port&gt;/ords/&lt;schema&gt;/project/batchload\
?batchesPerCommit=2\
&amp;batchRows=1\
&amp;dateFormat=YYYY-MM-DD\
&amp;delimiter=%2C\
&amp;errors=0\
&amp;lineEnd=%0A\
&amp;lineMax=1000\
&amp;locale=en_US\
&amp;responseEncoding=UTF-8\
&amp;responseFormat=RAW\
&amp;truncate=False" \
-H "Content-Type: text/csv" \
--data-binary "@project_data.csv"</pre>
  <button class="copyBtn" onclick="copyBlock(''curlcmd'')">Copy curl command</button>
  </div>
  ]'');

  -- Section 3: Parameter Table
  htp.p(q''[
  <h2>3. Main Query Parameters</h2>
  <table>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Example Value</th>
    </tr>
    <tr><td><code>batchesPerCommit</code></td><td>Number of batches per commit (<code>0</code> = commit at end only)</td><td>2</td></tr>
    <tr><td><code>batchRows</code></td><td>Rows per batch</td><td>1</td></tr>
    <tr><td><code>date' || 'Format</code></td><td>Date format for DATE columns</td><td>YYYY-MM-DD</td></tr>
    <tr><td><code>delimiter</code></td><td>Field delimiter (URL-encoded if needed)</td><td>,</td></tr>
    <tr><td><code>errors</code></td><td>Abort on N errors (<code>0</code> = abort on first; <code>-1</code> = unlimited)</td><td>0</td></tr>
    <tr><td><code>lineEnd</code></td><td>Line ending (e.g. <code>%0A</code> for <code>\n</code>)</td><td>%0A</td></tr>
    <tr><td><code>lineMax</code></td><td>Max characters per line</td><td>1000</td></tr>
    <tr><td><code>locale</code></td><td>Locale</td><td>en_US</td></tr>
    <tr><td><code>responseEncoding</code></td><td>Response text encoding</td><td>UTF-8</td></tr>
    <tr><td><code>responseFormat</code></td><td>Response layout (<code>RAW</code>, <code>SQL</code>)</td><td>RAW</td></tr>
    <tr><td><code>truncate</code></td><td>Delete rows before load (<code>True</code>, <code>Truncate</code>, or <code>False</code>)</td><td>False</td></tr>
  </table>
  ]'');

  -' || '- Section 4: Example Output
  htp.p(q''[
  <h2>4. Sample Response</h2>
  <div class="copy-block">
  <pre id="restresponse">
    #INFO Number of rows processed: 100
    #INFO Number of rows in error: 
    #INFO No rows committed
  </pre>
  </div>
  ]'');

  -- Section 5: References
  htp.p(q''[
  <h2>References</h2>
  <ul>
    <li><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/developing-REST-applications.html#GUID-CA242E61-9012-4081-85A0-CC410B18A3CD" target="_blank">
      Oracle ORDS Batchload Documentation
    </a></li>
    <li><a href="https://www.thatjeffsmith.com/archive/2022/10/batch-loading-csv-to-oracle-database-again-via-rest-apis/" target="_blank">
    A <code>BATCHLOAD</code> practical example (blog)</a></li>
    </ul>
  ]'');

  -- SVG stamp at bottom right
  htp.p(''
<div style="width:100%; display:flex; justify-content: flex-end; align-items:flex-end; margin-top:30px; color: gray; font-size: smaller;">
  <span style="display: flex; al' || 'ign-items: center;">
    <svg width="24" height="24" viewBox="0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
      <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.4722 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.9153 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3' || '674 40.6292 65.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.3042 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68' || '.4639 32.8028 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 68.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
    </svg>
    <sup>POST haste, REST later!</sup>
  </span>
</div>
'');

  htp.p(q''[
  </body>
  </html>
  ]'');

END;');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'filtering-in-queries',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'filtering-in-queries',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'BEGIN
  owa_util.mime_header(''text/html'', TRUE);
htp.p(''<html><head><title>ORDS Filtering in Queries Example</title>
  <style>
  body { font-family: Arial, sans-serif; }
  code, pre { background-color: #f4f4f4; padding: 2px 4px; border-radius: 4px; }
  table { border-collapse: collapse; width: 95%; }
  th, td { border: 1px solid #bbb; padding: 6px 8px; text-align: left; }
  th { background-color: #eee; }
  div.fexample { margin-bottom: 1.5em; }
  pre {
    display: inline-block;
    font-family: monospace;
    white-space: pre;
    margin-top: 1em;
    margin-right: 0px;
    max-width: 100%;
    overflow-x: auto;
  }
  .note-flex { display: flex; align-items: flex-end; margin-top: 1.5em; }
  .note-details { margin: 0; padding-right: 12px; }
  .indent-ex { margin-left: 2em; }
</style>
  </head><body>'');
htp.p(''<h1>ORDS Filtering in Queries: Comprehensive Example</h1>
        <p>This Reference API demonstrates how to use the <b><code>q=</code></b> filtering parameter with ORDS REST-enabl' || 'ed objects.
        This reference assumes you have created and AutoREST-enabled the <code>Employee</code> table.</p>
        <p>ORDS Query Filters support: direct values, advanced operators, complex logic, ranges, sorting, and more.</p>'');
  
-- Spaced Basic Filtering Examples with --location and --globoff
htp.p(q''[
<h2>1. Basic Filtering Examples</h2>
<div class="fexample">
  <div class="indent-ex">
    <b>Name equals "Bob":</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"EMP_NAME":"Bob"}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>Name contains "a" (case-insensitive, LIKE):</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"EMP_NAME":{"$like":"%a%"}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
   
 <b>Department is 3:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"DEPT_ID":3}''</pre>
  </d' || 'iv>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>EMP_ID greater than or equal to 5:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"EMP_ID":{"$gte":5}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>AND: Dept 3 AND Name contains "a":</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"$and":[{"DEPT_ID":3},{"EMP_NAME":{"$like":"%a%"}}]}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>Sort: Dept 3, sorted by EMP_NAME descending:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"DEPT_ID":3,"$orderby":{"EMP_NAME":"DESC"}}''</pre>
  </div>
</div>
<h2>2. Filtering Examples</h2>
<div class="fexample">
  <div class="indent-ex">
    <b>IN: Employees in departments 2, 3, or 4:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"DEPT_ID":{"$in":[2' || ',3,4]}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>NOT IN: Employees NOT in departments 2, 3, or 4:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"DEPT_ID":{"$nin":[2,3,4]}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>Sort by multiple columns, EMP_NAME NULLS LAST:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"$orderby":{"DEPT_ID":"ASC","EMP_NAME":["DESC","NULLS LAST"]}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>Date-based: HIREDATE after June 1, 2010:</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/ords/<schema>/employee/?q={"HIREDATE":{"$gt":{"$date":"2010-06-01T00:00:00Z"}}}''</pre>
  </div>
</div>
<div class="fexample">
  <div class="indent-ex">
    <b>Nested AND/OR: (Dept 3 OR 4) AND name LIKE "a":</b><br>
    <pre>curl --location --globoff ''https://<host>:<port>/or' || 'ds/<schema>/employee/?q={"$and":[{"$or":[{"DEPT_ID":3},{"DEPT_ID":4}]},{"EMP_NAME":{"$like":"%a%"}}]}''</pre>
  </div>
</div>
]'');

htp.p(''<h2>3. Operator Table Summary</h2>
        <table>
          <tr><th>Operator</th><th>Description</th><th>Example Value</th></tr>
          <tr><td><code>$eq</code></td><td>Equal</td><td>3</td></tr>
          <tr><td><code>$ne</code></td><td>Not equal</td><td>5</td></tr>
          <tr><td><code>$lt</code></td><td>Less than</td><td>100</td></tr>
          <tr><td><code>$lte</code></td><td>Less than or equal</td><td>10</td></tr>
          <tr><td><code>$</code></td><td>Greater than</td><td>7</td></tr>
          <tr><td><code>$gte</code></td><td>Greater than or equal</td><td>4</td></tr>
          <tr><td><code>$like</code></td><td>LIKE (wildcards % and _)</td><td>"%A%"</td></tr>
          <tr><td><code>$in</code></td><td>IN clause (array of values)</td><td>[1,2,3]</td></tr>
          <tr><td><code>$nin</code></td><td>NOT IN clause (array of values)</td>' || '<td>[4,5,6]</td></tr>
          <tr><td><code>$and</code></td><td>Logical AND (array of subfilters)</td><td>see above</td></tr>
          <tr><td><code>$or</code></td><td>Logical OR (array of subfilters)</td><td>see above</td></tr>
          <tr><td><code>$orderby</code></td><td>Sort key</td><td>{"COL":"ASC"}</td></tr>
          <tr><td><code>$date</code></td><td>Dates (RFC3339 in UTC/Z)</td><td>{"$date":"202001-01T00:00:00Z"}</td></tr>
        </table>'');
  
htp.p(''<h2>4. References</h2>
        <ul>
          <li><a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/developing-REST-applications.html#GUID-091748F8-3D14-402B-9310-25E6A9116B47" target="_blank">
            Oracle ORDS Filtering in Queries Documentation</a></li>
          <li><a href="https://www.thatjeffsmith.com/archive/2022/02/filtering-and-searching-strings-using-ords-query-parameters/" target="_blank">
          Filtering and string search with ORDS query parameters (blog)</a></li>' || '
        </ul>
        <p><strong>Notes:</strong></p>
        <ul>
          <li>Best practice to include <code>--location</code> (to follow redirects) and <code>--globoff</code> (to prevent curl from interpreting special characters).</li>
          <li>
            The <code>--globoff</code> option is <b>useful when making REST calls where URLs include curly braces
            or brackets</b>, as in ORDS <code>q=</code> filters. Otherwise curl may return “unmatched [ or {” errors.
          </li>
          <li>
            <strong>Single-quote your URL (as shown above) when it contains curly braces, brackets, or other shell-special characters.</strong>
            Otherwise, shell may misinterpret parts of the URL or you may receive an error from curl itself.
          </li>
          <li>Modify <code>&lt;host&gt;</code>, <code>&lt;port&gt;</code>, and <code>&lt;schema&gt;</code> for your environment.</li>
        </ul>
        '');
htp.p(''
<div style="width:100%; display:flex; justify' || '-content: flex-end; align-items:flex-end; margin-top:30px; color: gray; font-size: smaller;">
  <span style="display: flex; align-items: center;">
    <svg width="24" height="24" viewBox="0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
      <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.4722 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.915' || '3 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3674 40.6292 65.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.30' || '42 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68.4639 32.8028 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 68.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
    </svg>
    <sup>Stateless, but never dateless. ORDS.</sup>
  </span>
</div>
'');
  
htp.p(''</body></html>'');
END;');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'rest-enabled-sql-service',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'Pre-built ORDS Examples',
      p_pattern        => 'rest-enabled-sql-service',
      p_method         => 'GET',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'BEGIN
  owa_util.mime_header(''text/html'', TRUE);

htp.p(''<html><head><title>ORDS REST-Enabled SQL Service: PROJECT Table Usage Examples</title>
<style>
body { font-family: Arial, sans-serif; line-height: 1.5; }
code, pre { background-color: #f4f4f4; border-radius: 4px; padding: 2px 4px; }
pre {
  background-color: #f4f4f4;
  border-radius: 4px;
  padding: 12px 16px;
  overflow-x: auto;
  display: block;
  max-width: 700px;
  margin: 8px 0 16px 0;
}
div.example { margin-left: 2em; }
ul { margin-top: 0.2em; }
table { border-collapse: collapse; width: 97%; margin-left: 2em; }
th, td { border: 1px solid #bbb; padding: 6px 8px; text-align: left; vertical-align: top; }
th { background-color: #eee; }
div.section { margin-bottom: 2em; }
div.copy-block { margin-bottom: 16px; display: flex; flex-direction: column; align-items: flex-start; }
button.copyBtn { margin-top: 3px; font-size: 0.96em; cursor: pointer; }
</style>
<script>
function copyBlock(id){
  var code = document.getElementById(id);
 ' || ' if(code) navigator.clipboard.writeText(code.innerText);
}
</script>
</head><body>'');

htp.p(''<h1>ORDS REST-Enabled SQL Service</h1>
<p>This Reference API demonstrates practical usage of the <b>REST-Enabled SQL Endpoint</b> (&quot;/_/sql&quot;) using SQL and JSON payloads, and files.</p>
<p><b>Note:</b> All examples use the <code>PROJECT</code> table as the target table.</p>
</p>'');

htp.p(''<h2 id="project-usage">PROJECT Table Usage Examples</h2>'');

-- Inline SQL
htp.p(''<div class="section"><h3>1. Simple SQL Inline (<code>application/sql</code>)</h3>
<div class="example">
  <b>Single SQL statement:</b>
  <div class="copy-block">
  <pre id="curl1">curl -i -X POST --user ORDS:&lt;password&gt; --data-binary "select * from project where is_active = 1" -H "Content-Type: application/sql" https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl1'''')">Copy curl command</button>
  </div>
  <b>Multiple SQL statements:</b>
  <div class="copy-block">
  <pre' || ' id="curl2">curl -i -X POST --user ORDS105:&lt;password&gt; --data-binary "select count(*) from project; select proj_name from project where is_active=1;" -H "Content-Type: application/sql" https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl2'''')">Copy curl command</button>
  </div>
</div></div>'');

-- JSON inline
htp.p(''<div class="section"><h3>2. JSON Inline (<code>application/json</code>)</h3>
<div class="example">
  <b>SQL query in JSON document:</b>
  <div class="copy-block">
  <pre id="curl3">curl -i -X POST --user ORDS105:&lt;password&gt; -H "Content-Type: application/json" --data-binary ''''{ "statementText": "SELECT * FROM project WHERE dept_id = 3;" }'''' https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl3'''')">Copy curl command</button>
  </div>
  <b>With limit (pagination):</b>
  <div class="copy-block">
  <pre id="curl4">curl -i -X POST --user ORDS105:&lt;password&gt; -H "Content-Type: a' || 'pplication/json" --data-binary ''''{ "statementText": "SELECT proj_id, proj_name FROM project", "limit": 2 }'''' https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl4'''')">Copy curl command</button>
  </div>
</div></div>'');

-- .sql file
htp.p(''<div class="section"><h3>3. File Upload: .sql File</h3>
<div class="example">
  <b>Save this as <code>list_projects.sql</code>:</b>
  <div class="copy-block">
  <pre id="sqlfile">SELECT proj_id, proj_name, is_active FROM project WHERE is_active = 1;
SELECT COUNT(*) FROM project WHERE dept_id = 2;</pre>
  <button class="copyBtn" onclick="copyBlock(''''sqlfile'''')">Copy content</button>
  </div>
  <b>Then run:</b>
  <div class="copy-block">
  <pre id="curl5">curl -i -X POST --user ORDS105:&lt;password&gt; --data-binary "@list_projects.sql" -H "Content-Type: application/sql" https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl5'''')">Copy curl command</button>
  </div>
' || '</div></div>'');

-- .json file
htp.p(''<div class="section"><h3>4. File Upload: .json File</h3>
<div class="example">
  <b>Save this as <code>inactive_projects.json</code>:</b>
  <div class="copy-block">
  <pre id="jsonfile">{
  "statementText": "SELECT proj_id, proj_name FROM project WHERE is_active = 0",
  "limit": 10
}</pre>
  <button class="copyBtn" onclick="copyBlock(''''jsonfile'''')">Copy content</button>
  </div>
  <b>Then run:</b>
  <div class="copy-block">
  <pre id="curl6">curl -i -X POST --user ORDS105:&lt;password&gt; --data-binary "@inactive_projects.json" -H "Content-Type: application/json" https://&lt;HOST&gt;/ords/ORDS105/_/sql</pre>
  <button class="copyBtn" onclick="copyBlock(''''curl6'''')">Copy curl command</button>
  </div>
</div></div>'');

-- Data Types Table, revised
htp.p(''<h3>5. Supported Data Types and Example Values for SQL Binds</h3>
<table>
  <tr>
    <th>Data Type</th>
    <th>Example Value</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>DECIMAL<br>NUMBER<br>' || 'NUMERIC<br>DEC</td>
    <td>123</td>
    <td>Use for any whole or floating-point numbers. Accepts standard integer or decimal values.</td>
  </tr>
  <tr>
    <td>SMALLINT<br>INTEGER<br>INT</td>
    <td>42</td>
    <td>Synonyms for numeric types used for integer-only columns and binds.</td>
  </tr>
  <tr>
    <td>FLOAT</td>
    <td>3.14</td>
    <td>A floating point number; use for real numbers with decimals.</td>
  </tr>
  <tr>
    <td>DOUBLE PRECISION<br>REAL</td>
    <td>2.7182818</td>
    <td>Higher-precision floating-point types. Useful for scientific or large range calculations.</td>
  </tr>
  <tr>
    <td>BINARY_DOUBLE<br>BINARY_FLOAT</td>
    <td>123.456</td>
    <td>IEEE 754 floating-point numbers for optimized performance on Oracle Database.</td>
  </tr>
  <tr>
    <td>CHARACTER<br>CHAR</td>
    <td>abc</td>
    <td>Fixed-length character string; always stored as the declared length, space-padded.</td>
  </tr>
  <tr>
    <td>VARCHAR2<br>VARCHAR</td>
    <td>Sample text</td>
  ' || '  <td>Variable-length character strings (most common for text in Oracle); store up to the specified max length.</td>
  </tr>
  <tr>
    <td>CHARACTER VARYING<br>CHAR VARYING</td>
    <td>text</td>
    <td>Alternative ISO/ANSI-style type names for variable-length character data.</td>
  </tr>
  <tr>
    <td>NATIONAL CHARACTER<br>NATIONAL CHAR<br>NCHAR</td>
    <td>例子</td>
    <td>Unicode (national character set) fixed-length string. Use for multilingual support.</td>
  </tr>
  <tr>
    <td>NATIONAL CHARACTER VARYING<br>NATIONAL CHAR VARYING<br>NCHAR VARYING<br>NVARCHAR2<br>NVARCHAR</td>
    <td>例子123</td>
    <td>Unicode variable-length character types for internationalized applications.</td>
  </tr>
  <tr>
    <td>DATE</td>
    <td>01-Jan-2016</td>
    <td>Oracle DATE literal. Represents a date (optionally with time).</td>
  </tr>
  <tr>
    <td>TIMESTAMP</td>
    <td>1976-02-01T00:00:00Z</td>
    <td>Date and time in ISO 8601 format, optionally with timezone ("T" as separator). Useful ' || 'for precise date/time values.</td>
  </tr>
  <tr>
    <td>TIMESTAMP WITH LOCAL TIME ZONE<br>TIMESTAMP WITH TIME ZONE</td>
    <td>1976-02-01T00:00:00Z</td>
    <td>As above, but supports timezone for storing and retrieving time zone-aware timestamps.</td>
  </tr>
  <tr>
    <td>INTERVAL YEAR(2) TO MONTH<br>INTERVAL YEAR TO MONTH<br>INTERVALYM</td>
    <td>P10Y10M</td>
    <td>Interval that represents a year and month span (e.g., "10 years and 10 months"). Follows ISO 8601 period format.</td>
  </tr>
  <tr>
    <td>INTERVAL DAY(2) TO SECOND(6)<br>INTERVAL DAY TO SECOND<br>INTERVALDS</td>
    <td>P11DT10H10M10S</td>
    <td>Interval for days, hours, minutes, seconds (e.g., "11 days 10 hours 10 minutes 10 seconds"). ISO 8601 period.</td>
  </tr>
  <tr>
    <td>ROWID</td>
    <td>AAAPr9AAGAABQk9AAA</td>
    <td>Unique row identifier within an Oracle table; generally used for advanced operations or system queries.</td>
  </tr>
  <tr>
    <td>LONG RAW<br>RAW</td>
    <td>AB</td>
    <td>Bina' || 'ry strings (RAW) up to 2000 bytes; LONG RAW allows storage of longer binary data. Used for storing file blobs, etc.</td>
  </tr>
  <tr>
    <td>NCLOB<br>CLOB</td>
    <td>clobvalue</td>
    <td>Large Character (CLOB) or National Character (NCLOB) Objects. Used for text/blob storage of large unstructured data.</td>
  </tr>
  <tr>
    <td>LONG</td>
    <td>A ...</td>
    <td>Legacy Oracle SQL large text data type. For storing variable-length character data up to 2 gigabytes, though use is generally superseded by CLOB.</td>
  </tr>
</table>'');

htp.p(''<div class="section">
  <h3>6. References</h3>
  <ul style="margin-left:2em;">
    <li><b>Docs:</b> <a href="https://docs.oracle.com/en/database/oracle/oracle-rest-data-services/25.2/orddg/rest-enabled-sql-service.html#GUID-BA9F9457-ED3A-48A4-828A-CC8CBEA9A2AB$0" target="_blank">ORDS REST-Enabled SQL Service Documentation</a></li>
    <li><a href="https://followthecoffee.com/a-quick-ords-rest-enabled-sql-service-example/" target="_blank">A q' || 'uick REST-enabled SQL Service tutorial</a></li>
  </ul>
</div>'');

htp.p(''
<div style="width:100%; display:flex; justify-content: flex-end; align-items:flex-end; margin-top:30px; color: gray; font-size: smaller;">
  <span style="display: flex; align-items: center;">
    <svg width="24" height="24" viewBox="0 0 99 100" xmlns="http://www.w3.org/2000/svg" style="margin-right: 6px;">
      <path d="M49 82.8576 26.6778 74.9292 18.8854 27.4264 49 17.3882 79.1146 27.4264 71.3222 74.9632 49 82.8576ZM29.1278 72.9215 49 79.9653 68.8722 72.9215 76.0521 29.2639 49 20.2465 21.9479 29.2639 29.1278 72.9215ZM49 72.5813C45.9715 72.5813 43.1472 72.309 40.9694 71.7646 39.9146 71.5264 36.75 70.7438 36.75 68.566L36.75 49.3403C36.75 47.1625 39.9486 46.4139 40.9694 46.1417 43.1132 45.6313 45.9715 45.325 49 45.325 52.0285 45.325 54.8528 45.5972 57.0306 46.1417 58.0854 46.3799 61.25 47.1625 61.25 49.3403L61.25 68.566C61.25 70.7438 58.0514 71.4924 57.0306 71.7646 54.8528 72.275 52.0285 72.5813 49 72.5813ZM39.47' || '22 68.3278C40.2208 68.9062 43.5556 69.859 49 69.859 54.4444 69.859 57.7792 68.9062 58.5278 68.3278L58.5278 64.925C57.9153 65.1292 57.3708 65.2653 57.0306 65.3674 54.8868 65.8778 52.0285 66.184 49 66.184 45.9715 66.184 43.1472 65.9118 40.9694 65.3674 40.6292 65.2993 40.0507 65.1632 39.4722 64.925L39.4722 68.3278ZM39.4722 61.8965C40.2208 62.475 43.5556 63.4278 49 63.4278 54.4444 63.4278 57.7792 62.475 58.5278 61.8965L58.5278 58.4938C57.9153 58.6979 57.3708 58.834 57.0306 58.9361 54.8868 59.4465 52.0285 59.7528 49 59.7528 45.9715 59.7528 43.1472 59.4806 40.9694 58.9361 40.6292 58.8681 40.0507 58.7319 39.4722 58.4938L39.4722 61.8965ZM39.4722 55.4993C40.2208 56.0778 43.5556 57.0306 49 57.0306 54.4444 57.0306 57.7792 56.0778 58.5278 55.4993L58.5278 52.0965C57.9153 52.3007 57.3708 52.4368 57.0306 52.5389 54.8868 53.0493 52.0285 53.3556 49 53.3556 45.9715 53.3556 43.1472 53.0833 40.9694 52.5389 40.6292 52.4708 40.0507 52.3347 39.4722 52.0965L39.4722 55.4993ZM39.9146 49.3403C41.1736 49.9188 44.' || '3042 50.6333 49 50.6333 53.6958 50.6333 56.8264 49.9188 58.0854 49.3403 56.8264 48.7618 53.6958 48.0472 49 48.0472 44.3042 48.0813 41.1736 48.7958 39.9146 49.3403ZM68.7361 43.3174 59.8889 43.3174 59.8889 34.4701 62.6111 34.4701 62.6111 38.6556 68.4639 32.8028 70.4035 34.7424 64.5507 40.5951 68.7361 40.5951 68.7361 43.3174ZM38.1111 43.3174 29.2639 43.3174 29.2639 40.5951 33.4493 40.5951 27.5965 34.7424 29.5361 32.8028 35.3889 38.6556 35.3889 34.4701 38.1111 34.4701 38.1111 43.3174ZM50.3611 40.5951 47.6389 40.5951 47.6389 30.9313 44.5083 34.0618 42.5688 32.1222 49 25.725 55.3972 32.1222 53.4576 34.0618 50.3271 30.9313 50.3271 40.5951Z" fill="#FF0000"/>
    </svg>
    <sup>API-mazing things happening here!</sup>
  </span>
</div>
'');
htp.p(''</body></html>'');
END;');

  ORDS_ADMIN.DEFINE_MODULE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_base_path      => '/user_examples/',
      p_items_per_page => 25,
      p_status         => 'PUBLISHED',
      p_comments       => NULL);

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'emp-dept-summary',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'GET request that performs a SELECT * on the v_emp_dept_summary view. Returns a list of all employees joined with department information. Targets the view: v_emp_dept_summary (joins ''employee'' and ''department'' tables).');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'emp-dept-summary',
      p_method         => 'GET',
      p_source_type    => 'json/collection',
      p_mimes_allowed  => NULL,
      p_comments       => 'GET request that performs a SELECT * on the v_emp_dept_summary view. Returns a list of all employees joined with department information. Targets the view: v_emp_dept_summary (joins ''employee'' and ''department'' tables).',
      p_source         => 
'SELECT * FROM v_emp_dept_summary
    
--------------------------------------------------------------------------------
-- Handler: GET /emp-dept-summary
-- Purpose:
--   Returns a list of all employees joined with department information.
--   Targets the view: v_emp_dept_summary (joins ''employee'' and ''department'' tables).
--
-- How to test:
--   curl -X GET "{ORDS_BASE}/example/emp-dept-summary"
--
--   No body or query parameters are required.
--
--   Example output:
--   [
--     {
--       "emp_id": 1,
--       "emp_name": "Alice",
--       "dept_code": "HR001",
--       "established": "2001-04-13",
--       "details": {...},
--       "comments": "Strong analyst, quick learner."
--     },
--     ...
--   ]
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'dept-projects-dv',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'GET and POST requests on the dept_projects_dv Duality View. GET returns all departments as a JSON array, each with nested array of projects. Targets JSON-Relational Duality View: dept_projects_dv (on ''department'' and ''project'' tables). POST inserts a department with associated projects in a single request, using JSON structure as required by the duality view. Targets: ''department'' and ''project'' tables via the ''dept_projects_dv'' duality view.');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'dept-projects-dv',
      p_method         => 'GET',
      p_source_type    => 'json/collection',
      p_items_per_page => 25,
      p_mimes_allowed  => NULL,
      p_comments       => 'GET request returns all departments as a JSON array, each with nested array of projects. Targets JSON-Relational Duality View: dept_projects_dv (on ''department'' and ''project'' tables).',
      p_source         => 
'SELECT JSON_ARRAYAGG(data) AS departments
FROM dept_projects_dv

--------------------------------------------------------------------------------
-- Handler: GET /dept-projects-dv
-- Purpose:
--   Returns all departments as a JSON array, each with nested array of projects.
--   Targets JSON-Relational Duality View: dept_projects_dv (on ''department'' and ''project'' tables).
--
-- How to test:
--   curl -X GET "{ORDS_BASE}/example/dept-projects-dv"
--
--   No body or query parameters are required.
--
--   Example output:
--   {
--     "departments": [
--       {
--         "_id": 1,
--         "dept_code": "HR001",
--         "established": "...",
--         "details": {...},
--         "projects": [
--           {"proj_id": 101, "proj_name": "...", "is_active": true },
--           ...
--         ]
--       },
--       ...
--     ]
--   }
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'dept-projects-dv',
      p_method         => 'POST',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => 'POST request to insert a department with associated projects in a single request, using JSON structure as required by the duality view. Targets: ''department'' and ''project'' tables via the ''dept_projects_dv'' duality view.',
      p_source         => 
'DECLARE
    v_json CLOB := :body_text;  -- Use :body_text for readable JSON payload
BEGIN
    BEGIN
        INSERT INTO ORDS105.dept_projects_dv (data) VALUES (json(v_json));
        COMMIT;
        :result_message := ''Insert successful'';
    EXCEPTION
        WHEN OTHERS THEN
            :result_message := ''Insert failed: '' || SQLERRM;
            ROLLBACK;
    END;
END;

--------------------------------------------------------------------------------
-- Handler: POST /dept-projects-dv
-- Purpose:
--   Inserts a department with associated projects in a single request, using JSON structure as required by the duality view.
--   Targets: ''department'' and ''project'' tables via the ''dept_projects_dv'' duality view.
--
-- How to test:
--   curl -X POST "{ORDS_BASE}/example/dept-projects-dv" \
--        -H "Content-Type: application/json" \
--        -d ''{
--              "_id": 999,
--              "dept_code": "ZZ999",
--              "established": "2024-06-13",
--              "details": {' || '"location": "Bldg X", "members": 1},
--              "projects": [
--                 {"proj_id": 888, "proj_name": "TestProj", "is_active": true}
--              ]
--            }''
--
--   Example output:
--   {
--     "result_message": "Insert successful"
--   }
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_PARAMETER(
      p_schema => 'ORDS105',
      p_module_name        => 'User-created Examples',
      p_pattern            => 'dept-projects-dv',
      p_method             => 'POST',
      p_name               => 'result_message',
      p_bind_variable_name => 'result_message',
      p_source_type        => 'RESPONSE',
      p_param_type         => 'STRING',
      p_access_method      => 'OUT',
      p_comments           => NULL);

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'department-stats',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'GET request that returns department statistics, including counts of employees, all projects, and active projects (filtered to depts with max active projects). Targets ''department'', ''project'', and ''employee'' tables (via a SQL join and aggregation).');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'department-stats',
      p_method         => 'GET',
      p_source_type    => 'json/collection',
      p_mimes_allowed  => NULL,
      p_comments       => 'GET request demonstrating a more complex SQL query that returns department statistics; including counts of employees, all projects, and active projects (filtered to departments with max active projects). Targets ''department'', ''project'', and ''employee'' tables (via a SQL join and aggregation).',
      p_source         => 
'SELECT
    D.DEPT_ID,
    D.DEPT_CODE,
    COUNT(DISTINCT E.EMP_ID)  AS EMP_COUNT,
    COUNT(DISTINCT P.PROJ_ID) AS PROJECT_COUNT,
    SUM(
        CASE
            WHEN P.IS_ACTIVE = TRUE THEN
                1
            ELSE
                0
        END
    )                         AS ACTIVE_PROJ_COUNT
FROM
    DEPARTMENT D
    LEFT JOIN PROJECT    P ON D.DEPT_ID = P.DEPT_ID
    LEFT JOIN EMPLOYEE   E ON D.DEPT_ID = E.DEPT_ID
GROUP BY
    D.DEPT_ID,
    D.DEPT_CODE
HAVING
    SUM(
        CASE
            WHEN P.IS_ACTIVE = TRUE THEN
                1
            ELSE
                0
        END
    ) = (
        SELECT
            MAX(CNT)
        FROM
            (
                SELECT
                    COUNT(*) AS CNT
                FROM
                    PROJECT
                WHERE
                    IS_ACTIVE = TRUE
                GROUP BY
                    DEPT_ID
            )
    )
ORDER BY
    EMP_COUNT DESC
    
    ---------------------------------------' || '-----------------------------------------
-- Handler: GET /department-stats
-- Purpose:
--   Returns department statistics, including counts of employees, all projects, and active projects (filtered to depts with max active projects).
--   Targets ''department'', ''project'', and ''employee'' tables (via a SQL join and aggregation).
--
-- How to test:
--   curl -X GET "{ORDS_BASE}/example/department-stats"
--
--   No body or query parameters required.
--
--   Example output:
--   [
--     {
--       "dept_id": 1,
--       "dept_code": "HR001",
--       "emp_count": 3,
--       "project_count": 2,
--       "active_proj_count": 2
--     },
--     ...
--   ]
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'add-employee',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'POST request that adds a new employee to the specified department using parameters. Calls the PL/SQL procedure: pr_add_and_assign_employee (targets ''employee'' table and ''department'' by code).');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'add-employee',
      p_method         => 'POST',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => 'POST request that adds a new employee to the specified department using ORDS'' Automatic Bind Parameter capability. Resource Handler code calls the "pr_add_and_assign_employee" PL/SQL Procedure (targets ''employee'' table and ''department'' by code).',
      p_source         => 
'DECLARE

BEGIN
    BEGIN
        PR_ADD_AND_ASSIGN_EMPLOYEE(
            P_EMP_NAME  => :EMP_NAME,
            P_DEPT_CODE => :DEPT_CODE,
            P_COMMENTS  => :COMMENTS
        );

-- Note: You will need to create a Bind Parameter called "add_status", with the 
-- following characteristics:
-- Name: add_status
-- Bind variable: add_status
-- Source type: Response
-- Access Method: Out
-- Parameter type: String
-- Comments: optional

        :ADD_STATUS := ''Employee added successfully'';
    EXCEPTION
        WHEN OTHERS THEN
            :ADD_STATUS := ''Failed to add employee: '' || SQLERRM;
    END;
END;

--------------------------------------------------------------------------------
-- Handler: POST /add-employee
-- Purpose:
--   Adds a new employee to the specified department using parameters.
--   Calls the PL/SQL procedure: pr_add_and_assign_employee (targets ''employee'' table and ''department'' by code).
--
-- How to te
st:
--   curl -X POST "{ORDS_BASE}/example/add-employee" \
-' || '-        -H "Content-Type: application/json" \
--        -d ''{
--              "emp_name": "Kim",
--              "dept_code": "HR001",
--              "comments": "New HR assistant."
--            }''
--
--   Example output:
--   {
--     "add_status": "Employee added successfully"
--   }
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_PARAMETER(
      p_schema => 'ORDS105',
      p_module_name        => 'User-created Examples',
      p_pattern            => 'add-employee',
      p_method             => 'POST',
      p_name               => 'add_status',
      p_bind_variable_name => 'add_status',
      p_source_type        => 'RESPONSE',
      p_param_type         => 'STRING',
      p_access_method      => 'OUT',
      p_comments           => NULL);

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'longest-tenured-employee',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'GET request that returns the name of the employee with the longest comment (using a function). Targets ''employee'' table through the fn_longest_tenured_employee function.');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'longest-tenured-employee',
      p_method         => 'GET',
      p_source_type    => 'json/collection',
      p_mimes_allowed  => NULL,
      p_comments       => 'GET request that returns the name of the employee with the longest comment (using a function). Targets ''employee'' table through the fn_longest_tenured_employee function. Notice how the Source Type = Collection Query, important for returning an JSON Object that is consistent with your other endpoints.',
      p_source         => 
'SELECT
    FN_LONGEST_TENURED_EMPLOYEE AS EMP_NAME
FROM
    DUAL

--------------------------------------------------------------------------------
-- Handler: GET /longest-tenured-employee
-- Purpose:
--   Returns the name of the employee with the longest comment (using a function).
--   Targets ''employee'' table (through fn_longest_tenured_employee).
--
-- How to test:
--   curl -X GET "{ORDS_BASE}/example/longest-tenured-employee"
--
--   No body or query parameters required.
--
--   Example output:
--   {
--     "emp_name": "Judy"
--   }
--------------------------------------------------------------------------------');

  ORDS_ADMIN.DEFINE_TEMPLATE(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'dept-projects-dv/:dept_id',
      p_priority       => 0,
      p_etag_type      => 'HASH',
      p_etag_query     => NULL,
      p_comments       => 'PUT request option based on the dept-projects-dv template. Uses the "deptid" to update a department (and its nested projects) using a JSON object. Targets: ''department'' and ''project'' tables via the ''dept_projects_dv'' duality view.');

  ORDS_ADMIN.DEFINE_HANDLER(
      p_schema => 'ORDS105',
      p_module_name    => 'User-created Examples',
      p_pattern        => 'dept-projects-dv/:dept_id',
      p_method         => 'PUT',
      p_source_type    => 'plsql/block',
      p_mimes_allowed  => NULL,
      p_comments       => NULL,
      p_source         => 
'DECLARE
    v_json CLOB := :body_text;
BEGIN
    -- Try to update existing row
    UPDATE dept_projects_dv
    SET data = json(v_json)
    WHERE json_value(data, ''$._id'') = :dept_id;

    IF SQL%ROWCOUNT = 0 THEN
        -- If no row updated, insert new with incoming JSON
        INSERT INTO dept_projects_dv (data)
        VALUES (json(v_json));
    END IF;

    COMMIT;
    :result_message := ''Update/Insert successful'';
EXCEPTION
    WHEN OTHERS THEN
        :result_message := ''Update/Insert failed: '' || SQLERRM;
        ROLLBACK;
END;

--------------------------------------------------------------------------------
-- Handler: PUT /dept-projects-dv/:dept_id
-- Purpose:
--   Updates an existing department and change its projects via duality view
--
-- Scenario:
--   A department with dept_id = 999 already exists with two projects (proj_id = 888, 889).
--
--   - You will update the department''s code and details.
--   - You will also:
--       - Update project 888 (change its name and is' || '_active).
--       - Remove project 889 (by omitting it in the payload).
--       - Add a new project (proj_id = 890).
--
--   The handler will map these changes correctly via the duality view.

-- curl -X PUT "{ORDS_BASE}/example/dept-projects-dv/999" \
--     -H "Content-Type: application/json" \
--      -d ''{
--            "_id": 999,
--            "dept_code": "ZZ001",
--            "established": "2022-01-01",
--            "details": {"location": "Bldg Y", "members": 5},
--            "projects": [
--              {"proj_id": 888, "proj_name": "Project Phoenix", "is_active": true},
--              {"proj_id": 890, "proj_name": "Project Apollo", "is_active": false}
--            ]
--          }''

-- Expected Outcome:
-- - In the DEPARTMENT table:
--     - Row for dept_id=999 is updated: dept_code changed to ZZ001,
--       established date to 2022-01-01, location and members updated.
--
-- - In the PROJECT table:
--     - proj_id=888 (for dept_id=999) is updated: proj_name to "Pro' || 'ject Phoenix", is_active=true.
--     - proj_id=890 (for dept_id=999) is INSERTED as a new project.

-- Tables to Review (after the update):
--   1. DEPARTMENT
--      - Check dept_code, established, and other fields for dept_id=999.
--   2. PROJECT
--      - Check that only proj_id 888 and 890 exist for dept_id=999.
--      - Verify their proj_name and is_active fields are as updated.

-- What to Look Out For:
--   - All changes in the payload are accurately reflected in both tables.
--   - No unexpected rows are inserted or deleted.
--   - There are no mismatches between the department’s primary key and referenced rows in PROJECT.
--   - If you see unique constraint errors: check that dept_id and proj_id values are correctly aligned between input JSON and existing records.');

  ORDS_ADMIN.DEFINE_PARAMETER(
      p_schema => 'ORDS105',
      p_module_name        => 'User-created Examples',
      p_pattern            => 'dept-projects-dv/:dept_id',
      p_method             => 'PUT',
      p_name               => 'result_message',
      p_bind_variable_name => 'result_message',
      p_source_type        => 'RESPONSE',
      p_param_type         => 'STRING',
      p_access_method      => 'OUT',
      p_comments           => NULL);

  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'Role for Authorization Code grant type OAuth2.0 example');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'Role for Client Credentials grant type OAuth2.0 example');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'Role for Implicit grant type OAuth2.0 example');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'oracle.dbtools.role.autorest.ORDS105');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'oracle.dbtools.role.autorest.ORDS105.DEPARTMENT');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'oracle.dbtools.role.autorest.ORDS105.EMPLOYEE');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'oracle.dbtools.role.autorest.ORDS105.PROJECT');
  ORDS_ADMIN.CREATE_ROLE(
      p_schema => 'ORDS105',
      p_role_name=> 'oracle.dbtools.role.autorest.any.ORDS105');
  l_roles(1) := 'oracle.dbtools.autorest.any.schema';
  l_roles(2) := 'oracle.dbtools.role.autorest.ORDS105';
  l_patterns(1) := '/metadata-catalog/*';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'oracle.dbtools.autorest.privilege.ORDS105',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'ORDS105 metadata-catalog access',
      p_description    => 'Provides access to the metadata catalog of the objects in the ORDS105 schema.',
      p_comments       => NULL); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_roles(1) := 'oracle.dbtools.autorest.any.schema';
  l_roles(2) := 'oracle.dbtools.role.autorest.ORDS105.DEPARTMENT';
  l_roles(3) := 'oracle.dbtools.role.autorest.any.ORDS105';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'oracle.dbtools.autorest.privilege.ORDS105.DEPARTMENT',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'ORDS105.DEPARTMENT access',
      p_description    => 'Provides access to the DEPARTMENT TABLE in the ORDS105 schema.',
      p_comments       => NULL); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_roles(1) := 'oracle.dbtools.autorest.any.schema';
  l_roles(2) := 'oracle.dbtools.role.autorest.ORDS105.EMPLOYEE';
  l_roles(3) := 'oracle.dbtools.role.autorest.any.ORDS105';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'oracle.dbtools.autorest.privilege.ORDS105.EMPLOYEE',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'ORDS105.EMPLOYEE access',
      p_description    => 'Provides access to the EMPLOYEE TABLE in the ORDS105 schema.',
      p_comments       => NULL); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_roles(1) := 'oracle.dbtools.autorest.any.schema';
  l_roles(2) := 'oracle.dbtools.role.autorest.ORDS105.PROJECT';
  l_roles(3) := 'oracle.dbtools.role.autorest.any.ORDS105';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'oracle.dbtools.autorest.privilege.ORDS105.PROJECT',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'ORDS105.PROJECT access',
      p_description    => 'Provides access to the PROJECT TABLE in the ORDS105 schema.',
      p_comments       => NULL); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_roles(1) := 'SODA Developer';
  l_patterns(1) := '/soda/*';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'oracle.soda.privilege.developer',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => NULL,
      p_description    => NULL,
      p_comments       => NULL); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_patterns(1) := '/protected_endpoint_examples/authorization-code';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'privilege.for.authorization.code.example',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'privilege.for.authorization.code.example',
      p_description    => 'privilege.for.authorization.code.example',
      p_comments       => 'privilege.for.authorization.code.example'); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_patterns(1) := '/protected_endpoint_examples/client-credentials';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'privilege.for.client.credentials.example',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'privilege.for.client.credentials.example',
      p_description    => 'privilege.for.client.credentials.example',
      p_comments       => 'privilege.for.client.credentials.example'); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  l_patterns(1) := '/protected_endpoint_examples/implicit-grant';

  ORDS_ADMIN.DEFINE_PRIVILEGE(
      p_schema => 'ORDS105',
      p_privilege_name => 'privilege.for.implicit.grant.example',
      p_roles          => l_roles,
      p_patterns       => l_patterns,
      p_modules        => l_modules,
      p_label          => 'privilege.for.implicit.grant.example',
      p_description    => 'privilege.for.implicit.grant.example',
      p_comments       => 'privilege.for.implicit.grant.example'); 

  l_roles.DELETE;
  l_modules.DELETE;
  l_patterns.DELETE;

  ORDS_ADMIN.ENABLE_OBJECT(
      p_schema => 'ORDS105',
      p_enabled => TRUE, 
      p_object => 'DEPARTMENT',
      p_object_type => 'TABLE',
      p_object_alias => 'department',
      p_auto_rest_auth => FALSE);

  ORDS_ADMIN.ENABLE_OBJECT(
      p_schema => 'ORDS105',
      p_enabled => TRUE, 
      p_object => 'EMPLOYEE',
      p_object_type => 'TABLE',
      p_object_alias => 'employee',
      p_auto_rest_auth => FALSE);

  ORDS_ADMIN.ENABLE_OBJECT(
      p_schema => 'ORDS105',
      p_enabled => TRUE, 
      p_object => 'PROJECT',
      p_object_type => 'TABLE',
      p_object_alias => 'project',
      p_auto_rest_auth => FALSE);


  ORDS_SECURITY_ADMIN.IMPORT_CLIENT(
      p_schema => 'ORDS105',
      p_name             => 'authorization_code_example',
      p_client_id        => '9XFh-zhj34D_T3CESdSKtw..',
      p_grant_type       => 'authorization_code',
      p_owner            => 'ORDS105',
      p_description      => 'Authorization Code Grant
Description: Used by server-side (confidential) apps; the client redirects the user to the authorization server, gets an authorization code, then exchanges it for an access token (and optionally a refresh token).
Flow: User → Authorization Server (grant code) → Client with code → Authorization Server (get token).
When to Use: For web applications where client secrets can be securely stored (server-side apps).
Security: Highly secure as sensitive tokens are exchanged server-to-server, not exposed to the user''s browser.',
      p_origins_allowed  => NULL,
      p_redirect_uri     => 'https://oauth.pstmn.io/v1/callback',
      p_support_email    => 'chris.hoina@oracle.com',
      p_support_uri      => 'https://www.oracle.com/support',
      p_token_duration   => NULL,
      p_refresh_duration => NULL,
      p_code_duration    => NULL,
      p_privilege_names  => 'privilege.for.authorization.code.example');

  ORDS_SECURITY_ADMIN.IMPORT_CLIENT(
      p_schema => 'ORDS105',
      p_name             => 'client_credentials_example',
      p_client_id        => 'be7Cyj_VajoUIOtZEWMZRA..',
      p_grant_type       => 'client_credentials',
      p_owner            => 'ORDS105',
      p_description      => 'Client Credentials Grant
Description: The client application itself requests an access token from the authorization server using its own credentials (no user context involved).
Flow: Client → Authorization Server (get token with client credentials).
When to Use: For machine-to-machine (M2M) communication, backend services, or daemons that need to access resources directly.
Security: Only suitable for trusted, backend-to-backend scenarios.',
      p_origins_allowed  => NULL,
      p_redirect_uri     => NULL,
      p_support_email    => 'chris.hoina@oracle.com',
      p_support_uri      => 'https://www.oracle.com/support',
      p_token_duration   => NULL,
      p_refresh_duration => NULL,
      p_code_duration    => NULL,
      p_privilege_names  => 'privilege.for.client.credentials.example');

   ORDS_SECURITY_ADMIN.GRANT_CLIENT_ROLE(
      p_schema => 'ORDS105',
      p_client_name     => 'client_credentials_example',
      p_role_name => 'Role for Client Credentials grant type OAuth2.0 example');

  ORDS_SECURITY_ADMIN.IMPORT_CLIENT(
      p_schema => 'ORDS105',
      p_name             => 'implicit_grant_example',
      p_client_id        => 'UWCr3z_SjdYo1II2pIMdLg..',
      p_grant_type       => 'implicit',
      p_owner            => 'ORDS105',
      p_description      => 'Implicit Grant (NOT RECOMMENDED)
Description: The client (usually a SPA) obtains the access token directly from the authorization server via the browser, without an intermediate authorization code.
When to Use: Historically used for SPAs but now not recommended due to increased risk of exposure.
Security: Less secure—tokens are exposed to the browser and more vulnerable to attacks. Use Authorization Code with PKCE instead.',
      p_origins_allowed  => NULL,
      p_redirect_uri     => 'https://localhost:3000/redirect',
      p_support_email    => 'chris.hoina@oracle.com',
      p_support_uri      => 'https://www.oracle.com/support',
      p_token_duration   => NULL,
      p_refresh_duration => NULL,
      p_code_duration    => NULL,
      p_privilege_names  => 'privilege.for.implicit.grant.example');

COMMIT;

END;

